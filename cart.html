<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head><!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚ÙŠÙ…
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
<meta charset="UTF-8">
<title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Ù…Ø§Ù‡Ø± ÙÙˆÙ†</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<style>.product-img { height: 120px; object-fit: contain; }</style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark p-3">
<div class="container d-flex justify-content-between">
<a class="navbar-brand" href="index.html">ğŸ“± Ù…Ø§Ù‡Ø± ÙÙˆÙ†</a>
<span class="text-white">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
</div>
</nav>

<div class="container mt-4">
<h2 class="mb-3">Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</h2>
<div id="cartItems" class="row g-3"></div>
<hr>
<h4 class="mt-3">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalPrice">0</span> Ø¬Ù†ÙŠÙ‡</h4>
<button class="btn btn-danger mt-3" onclick="clearCart()">Ø­Ø°Ù Ø§Ù„Ø³Ù„Ø©</button>
</div>

<script>
function loadCart() {
    let cart=JSON.parse(localStorage.getItem('cart'))||[];
    let container=document.getElementById('cartItems'); let total=0;
    container.innerHTML='';
    cart.forEach((item,index)=>{
        total+=item.price;
        container.innerHTML+=`
        <div class="col-md-4">
        <div class="card p-3 shadow-sm text-center">
        <img src="${item.img}" class="product-img mb-2">
        <h5>${item.name}</h5>
        <p class="text-danger fw-bold">${item.price.toLocaleString()} Ø¬Ù†ÙŠÙ‡</p>
        <button class="btn btn-dark" onclick="removeItem(${index})">Ø­Ø°Ù</button>
        </div></div>`;
    });
    document.getElementById('totalPrice').innerText=total.toLocaleString();
}

function removeItem(index){
    let cart=JSON.parse(localStorage.getItem('cart'))||[];
    cart.splice(index,1); localStorage.setItem('cart',JSON.stringify(cart)); loadCart();
}

function clearCart(){ localStorage.removeItem('cart'); loadCart(); }

window.addEventListener('storage',loadCart);
loadCart();
</script>

</body>

</html><script>
// ØªÙˆÙ„ÙŠØ¯ UUID Ø¨Ø³ÙŠØ·
function genId() {
  return 'id-' + Date.now() + '-' + Math.random().toString(36).slice(2,9);
}
let guestId = localStorage.getItem('guestId');
if (!guestId) {
  guestId = genId();
  localStorage.setItem('guestId', guestId);
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù…Ù† localStorage
function getCart() {
  return JSON.parse(localStorage.getItem('cart-'+guestId) || '[]');
}
function saveCart(items) {
  localStorage.setItem('cart-'+guestId, JSON.stringify(items));
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© (Ù…Ø«Ø§Ù„)
function addToCart(product) {
  const cart = getCart();
  // product = {id, name, price, qty}
  const found = cart.find(p => p.id === product.id);
  if (found) found.qty += product.qty;
  else cart.push(product);
  saveCart(cart);
  renderCart();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø©
function renderCart() {
  const cart = getCart();
  const container = document.getElementById('cart-items'); // Ø¶ÙŠÙ Ø¹Ù†ØµØ± Ø¨Ø§Ù„Ù€ id Ø¯Ø§ ÙÙŠ cart.html
  if(!container) return;
  container.innerHTML = '';
  cart.forEach(item => {
    const el = document.createElement('div');
    el.innerText = ${item.name} - ${item.qty} Ã— ${item.price};
    container.appendChild(el);
  });
}

// Checkout: Ø±ÙØ¹ Ø§Ù„Ø³Ù„Ø© ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù€ Firestore
async function checkout(name, phone, address) {
  const cart = getCart();
  if (!cart.length) { alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©'); return; }
  const docRef = db.collection('carts').doc(guestId);
  await docRef.set({
    guestId,
    items: cart,
    name,
    phone,
    address,
    status: 'new',
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨
  localStorage.removeItem('cart-'+guestId);
  alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨! Ù‡Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ø§Ùƒ Ù‚Ø±ÙŠØ¨Ø§');
  renderCart();
}

// Ù…Ø«Ø§Ù„: Ø±Ø¨Ø· ÙÙˆØ±Ù… Ø§Ù„Ù€ checkout Ø¨Ø²Ø±Ø§Ø±
document.addEventListener('DOMContentLoaded', () => {
  renderCart();
  const checkoutForm = document.getElementById('checkout-form');
  if (checkoutForm) {
    checkoutForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = checkoutForm.querySelector('[name=name]').value;
      const phone = checkoutForm.querySelector('[name=phone]').value;
      const address = checkoutForm.querySelector('[name=address]').value;
      checkout(name, phone, address).catch(err => { console.error(err); alert('Ø­ØµÙ„ Ø®Ø·Ø£'); });
    });
  }
});
</script>


