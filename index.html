<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…ØªØ¬Ø± Maher</title>
<style>
  body{font-family:Arial,sans-serif; padding:20px; direction:rtl;}
  .product, .cart-item{border:1px solid #ccc;padding:10px;margin-bottom:10px;}
</style>
</head>
<body>

<h1>Ù…ØªØ¬Ø± Maher</h1>

<h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
<div id="products-list"></div>

<h2>Ø§Ù„Ø³Ù„Ø©</h2>
<div id="cart-items">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>

<form id="checkout-form">
  <input type="text" name="name" placeholder="Ø§Ø³Ù…Ùƒ" required>
  <input type="text" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
  <input type="text" name="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required>
  <button type="submit">Ø§Ù„Ø¯ÙØ¹</button>
</form>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
function genId(){return 'id-'+Date.now()+'-'+Math.random().toString(36).slice(2,9);}
let guestId = localStorage.getItem('guestId');
if(!guestId){guestId=genId();localStorage.setItem('guestId',guestId);}
function getCart(){return JSON.parse(localStorage.getItem('cart-'+guestId)||'[]');}
function saveCart(items){localStorage.setItem('cart-'+guestId,JSON.stringify(items));}

function renderCart(){
  const cart = getCart();
  const container = document.getElementById('cart-items');
  container.innerHTML='';
  if(!cart.length){container.innerText='Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'; return;}
  cart.forEach(i=>{
    const el = document.createElement('div');
    el.className='cart-item';
    el.innerText=`${i.name} - ${i.qty} Ã— ${i.price}`;
    container.appendChild(el);
  });
}

function addToCart(product){
  const cart = getCart();
  const found = cart.find(p=>p.id===product.id);
  if(found) found.qty += product.qty;
  else cart.push(product);
  saveCart(cart);
  renderCart();
}

// ======== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firestore ========
async function loadProducts(){
  const container = document.getElementById('products-list');
  container.innerHTML='Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
  const snapshot = await db.collection('products').get();
  container.innerHTML='';
  snapshot.forEach(doc=>{
    const p = doc.data();
    const el = document.createElement('div');
    el.className='product';
    el.innerHTML = <strong>${p.name}</strong> - Ø§Ù„Ø³Ø¹Ø±: ${p.price} <button onclick="addToCart({...p, qty:1})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>;
    container.appendChild(el);
  });
}

async function checkout(name,phone,address){
  const cart = getCart();
  if(!cart.length){alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©'); return;}
  await db.collection('carts').doc(guestId).set({
    guestId,
    items: cart,
    name,
    phone,
    address,
    status:'new',
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  localStorage.removeItem('cart-'+guestId);
  renderCart();
  alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!');
}

document.addEventListener('DOMContentLoaded',()=>{
  loadProducts();
  renderCart();
  const form=document.getElementById('checkout-form');
  form.addEventListener('submit',e=>{
    e.preventDefault();
    const name=form.name.value;
    const phone=form.phone.value;
    const address=form.address.value;
    checkout(name,phone,address).catch(err=>{console.error(err); alert('Ø­ØµÙ„ Ø®Ø·Ø£');});
  });
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø§Ù‡Ø± ÙÙˆÙ†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background: #f5f5f5; }
        .product-img { height: 220px; object-fit: contain; }
        .navbar-brand { font-size: 25px; font-weight: bold; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark p-3">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand" href="#">ğŸ“± Ù…Ø§Ù‡Ø± ÙÙˆÙ†</a>
        <div>
            <button class="btn btn-outline-light me-2" onclick="location.href='products.html'">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            <button class="btn btn-light" onclick="location.href='cart.html'">ğŸ›’ Ø§Ù„Ø³Ù„Ø©</button>
            <button class="btn btn-outline-warning" onclick="location.href='admin.html'">ğŸ”§ Admin</button>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="p-5 text-center bg-white rounded shadow">
        <h1 class="mb-3">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø± Ù…Ø§Ù‡Ø± ÙÙˆÙ†</h1>
        <p class="lead">Ø£ÙØ¶Ù„ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª ÙÙŠ Ù…ØµØ± â€“ Ø´Ø­Ù† Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</p>
        <button onclick="location.href='products.html'" class="btn btn-dark btn-lg mt-3">ØªØµÙÙ‘Ø­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    </div>

    <h2 class="mt-5">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div id="previewProducts" class="row g-4 mt-2"></div>
</div>

<footer class="bg-dark text-white text-center p-3 mt-5">
    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù…Ø§Ù‡Ø± ÙÙˆÙ† 2025
</footer>

<script>
function getProducts() {
    let p = JSON.parse(localStorage.getItem('products'));
    return p && Array.isArray(p) ? p : [];
}

function cryptoRandomId() {
    return 'id-' + Math.random().toString(36).slice(2,9);
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
function addToCart(productId) {
    let products = getProducts();
    let prod = products.find(p => p.id === productId);
    if (!prod) return alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.push({id: prod.id, name: prod.name, price: prod.price, img: prod.img});
    localStorage.setItem('cart', JSON.stringify(cart));
    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©");
}

// Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø¢Ø®Ø± 3 Ù…Ù†ØªØ¬Ø§Øª)
function renderPreview() {
    let products = getProducts();
    let container = document.getElementById('previewProducts');
    container.innerHTML = '';
    if (!products || products.length === 0) {
        container.innerHTML = '<p class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.</p>';
        return;
    }
    let slice = products.slice(-3).reverse();
    slice.forEach(prod => {
        container.innerHTML += `
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <img src="${prod.img}" class="card-img-top product-img">
                    <div class="card-body text-center">
                        <h5 class="card-title">${prod.name}</h5>
                        <p class="text-danger fw-bold">${prod.price.toLocaleString()} Ø¬Ù†ÙŠÙ‡</p>
                        <button class="btn btn-dark" onclick="addToCart('${prod.id}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                    </div>
                </div>
            </div>
        `;
    });
}

// Ø±Ø§Ø­ ÙŠØªÙ†ÙØ° ÙƒÙ„ Ù…Ø±Ø© ØªØªØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
window.addEventListener('storage', renderPreview);
renderPreview();
</script>

</body>
</html>
